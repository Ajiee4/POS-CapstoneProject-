
@inject POS_CapstoneProject_.Data.POS_CapstoneProject_Context data;
@{
    Layout = "/Views/Shared/_ManagerLayout.cshtml";
    var categoryList = ViewData["CategoryList"] as List<Category>;
    var productList = ViewData["ProductList"] as List<Product>;
}

<style>
    .header .right-section .checkout-icon {
        display: block ;
    }

    .container-all{
        overflow:hidden !important;
    }

    .link-sales {
        background-color: #747474 !important;
    }
</style>

<!--Loader-->
<div class="loader-wrapper">
    <div class="loader"></div>
</div>

<!--Checkout Wrapper-->
<div class="checkout-wrapper checkHide">
    <div class="checkout-content-wrapper">
       
        <button type="button" class="close exitCheckout">
            <span aria-hidden="true">&times;</span>
        </button>
        <!--Checkout Header-->
        <h1 class="checkout-title">Check Out</h1>
        <!--Checkout Table Wrapper-->
        <div class="checkout-table-wrapper">
            <!--Checkout Table-->
            <table class="checkout-table">
                <thead>
                    <tr>
                        <th style="color: transparent">aaa</th>
                        <th class="table-header-name">Name &nbsp;&nbsp;&nbsp;</th>
                        <th class="table-header-quantity">Qty</th>
                        <th class="table-header-coffee">w/coffee</th>
                        <th class="table-header-price">Price &nbsp;</th>
                    </tr>
                </thead>

                <tbody>
                </tbody>
            </table>
        </div>
        <!--Checkout Footer-->
        <div class="checkout-footer">
            <div class="discount-wrapper">
                <label for="inputDiscount">Discount (%)</label>
                <input id="inputDiscount" value="0" maxlength="2" onchange="ApplyDiscount(this)" oninput="validateInput(this)" />
            </div>

            <div class="tax-wrapper">
                <span>Tax</span>
                <span>₱0.00</span>
            </div>

            <div class="subtotal-wrapper">
                <span class="subTotalText">Sub Total </span>
                <span class="subTotalValue">₱0.00</span>
            </div>

            <div class="totalamount-wrapper">
                <span class="TotalAmountText">Total</span>
                <span class="TotalAmount">₱0.00</span>
            </div>

            <div class="checkout-btn">
                <button class="cancelBtn">Cancel</button>
                <button class="payBtn">Buy</button>
            </div>
        </div>
    </div>
</div> 

<!--Product List Wrapper-->
<div class="product-list-wrapper">
       <div class="search-wrapper">            
           <div class="searchProd">
               <div>
                    <span>Search: </span>
               </div>
             
                <div>
                    <input type="search" class="searchProductInput" onkeyup="searchProduct()">
                </div>              
            </div>       
       </div>

       <div class="category-list-wrapper">
            <button class="category-item active" data-category="All" onclick="FilterProduct('All')">All</button>

            @if(categoryList != null)
            {
                @foreach (var item in categoryList)
                {
                    <button class="category-item" data-category="@item.CategoryName" onclick="FilterProduct('@item.CategoryName')">
                        @item.CategoryName
                    </button>
                }
            }               
       </div>

       <div class="product-catalog">
           <div class="noResult">Nothing Found...</div>
            
            @if(productList != null)
            {
                if(productList.Count == 0)
                {
                    <script>
                        document.querySelector('.noResult').style.display = "block";
                    </script>
                }
                else
                {
                    @foreach (var prod in productList)
                    {
                        <div class="product-item" onclick="checkoutProduct(@prod.ProductId, '@prod.Name',1, @prod.Price)" data-category="@prod.Category?.CategoryName" data-toggle="tooltip" data-placement="bottom" title="@prod.Name">
                            <div class="product-item-img">
                                @if (prod.ImageData != null)
                                {
                                    <img src="data:image/jpeg;base64,@Convert.ToBase64String(prod.ImageData)" class="d-block mx-auto" alt="Image" />
                                }
                                else
                                {
                                    <span></span>
                                }
                            </div>

                            <div class="product-item-name" data-category="@prod.Category?.CategoryName">
                                <span>@prod.Name</span>
                            </div>
                        </div>
                    }
                }            
            }
       </div>
</div>

<br />

<!--Payment Modal-->
<div class="modal fade general-modal" id="paymentModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <img src="~/images/coffe-logo-light.png" class="payment-sales-modal-img general-coffee-img-bottom" />

            <div class="modal-header">
                <h5 class="modal-title">PAYMENT</h5>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label general-modal-label">Amount Due</label>
                    <input class="form-control totalAmountInputReadOnly general-modal-input" readonly />
                </div>

                <div class="form-group">
                    <label class="control-label general-modal-label">Cash Tendered</label>
                    <input class="form-control amountInput general-modal-input" placeholder="Enter Cash Tendered" oninput="onInputCash(this)" />                     
                </div>

                <div class="form-group">
                    <label class="control-label general-modal-label">Change Due</label>
                    <input class="form-control changeAmountText general-modal-input" readonly />
                </div>
                                     
                <form asp-action="Index" method="post" id="formPay">
                    <input class="" name="checkoutList" id="checkOutListInput" hidden />
                    <input name="checkoutTotal" id="checkOutTotalInput" hidden />
                    <input name="changeDueAmount" id="changeDueAmount" hidden />
                    <input name="discount" id="discount" hidden />
                    <input name="cashTendered" id="cashTendered" hidden />
                    <input name="subTotalAmount" id="subTotalAmount" hidden />
                    <input name="totalString" id="totalString" hidden />
                </form>

                <div class="form-group calculate-wrapper">
                    <button type="button" class="d-block mx-auto calculateBtn general-modal-button">Pay</button>
                </div>               
            </div>
        </div>
    </div>
</div>


<!--Show Receipt after the transaction-->
@if (ViewData["TransactionComplete"] != null)
{      
    int? orderId = ViewData["orderID"] as int?;
    var myorder = @data.OrderDetails.Where(s => s.OrderId == orderId).ToList();

    <script>
        Swal.fire({
            text: "Transaction Complete",
            icon: "success",
            showConfirmButton: false,
            timer: 2000,
        }).then(() => {

            document.querySelector(".receipt").classList.add("showReceipt");         
            setTimeout(() => {
                window.print();
                document.querySelector(".receipt").classList.remove("showReceipt");
            }, 2000)
           
        });             
    </script>

    <!--Receipt-->
    <div class="receipt">
        <div class="receipt-content">
            <div class="receipt-header">
                <p class="name">Don Machiattos</p>
                <p>Date: @ViewData["OrderDate"]</p>
                <p>Cashier: @ViewData["UserName"]</p>
            </div>

            <hr />

            <div class="receipt-items">
                <div class="item-header">
                    <span>QTY</span>
                    <span>Name</span>
                    <span>Price</span>
                </div>

                @foreach (var item in myorder)
                {
                    <div class="item-list">
                        <span>@item.Quantity</span>
                        <span>@item.Product?.Name</span>
                        <span>₱@item.Product?.Price</span>
                    </div>
                }
            </div>

            <hr />

            <div class="receipt-calculation">

                <div class="discount">
                    <p>Discount</p>
                    <p>₱@ViewData["Discount"]</p>
                </div>

                <div class="tax">
                    <p>Tax</p>
                    <p>₱0.00</p>
                </div>

                <div class="total">
                    <p>Total</p>
                    <p>₱@ViewData["Total"]</p>
                </div>

            </div>

            <hr />

            <div class="receipt-change">
                <div class="cash">
                    <p>Cash</p>
                    <p>₱@ViewData["Cash"]</p>
                </div>

                <div class="change">
                    <p>Change</p>
                    <p>₱@ViewData["Change"]</p>
                </div>
            </div>

            <h3 class="footer">THANK YOU</h3>
        </div>
    </div>   
}
