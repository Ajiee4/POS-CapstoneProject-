@model POS_CapstoneProject_.Models.Ingredient
@inject IHttpContextAccessor HttpContextAccessor
@inject POS_CapstoneProject_.Data.POS_CapstoneProject_Context data
@{
    Layout = "/Views/Shared/_ManagerLayout.cshtml";
}
<style>
    .link-inventorylist, .inventoryMenu {
        background-color: #C6976C !important;
    }
</style>

<div class="inventory-wrapper">
  @*   <button>In/Out</button> *@
    <button type="button" class="addIngredientBtn" data-toggle="modal" data-target="#addIngredientModal">Add Item</button>
    <button class="btn requestIngredientBtn" type="button">Request</button>
   @*  <button type="button" class="InOutBtn" data-toggle="modal" data-target="#choiceIngredientModal">In/Out</button>
 *@

    <button type="button" class="stockInBtn">Stock In</button>
    <button type="button" class="stockOutBtn">Stock Out</button>

  
        <table class="inventory-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Unit of<br /> Measurement</th>
                    <th>Quantity</th>
                    <th>Stock<br /> Threshold</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in ViewData["IngredientsList"] as List<Ingredient>)
                {
                 @*    var requestList = ViewData["RequestList"]; *@
                var checkRequest = data.RequestDetails.Where(s => s.IngredientId == item.IngredientId && s.Request.Status == "Pending").FirstOrDefault();
              
                    <tr data-id="@item.IngredientId" data-name="@item.Name">

                        <td data-label="ID">@item.IngredientId</td>
                        <td data-label="Name">@item.Name</td>
                        <td data-label="Unit of Measurement">@item.UnitOfMeasurement</td>
                        <td data-label="Quantity">@item.Quantity</td>
                        <td data-label="Threshold">@item.LowStockThreshold</td>
                        <td data-label="Actions">
                            <!---->
                            @*   <button class="btn InOutBtn" data-id="@item.IngredientId" data-toggle="modal" data-target="#choiceIngredientModal">In/Out</button> *@

                            <div class="action-wrapper">
                                <div class="action-button">
                                    <button class="btn updateIngredientBtn" onclick="DefaultUpdateIngredientModal(@item.IngredientId, '@item.Name','@item.UnitOfMeasurement', @item.LowStockThreshold)"
                                            data-toggle="modal" data-target="#updateIngredientModal">
                                        Update
                                    </button>

                                          
                                    
                                </div>

                                    @if (item.Quantity < item.LowStockThreshold)
                                    {
                                        if (checkRequest != null)
                                        {
                                            <div class="warning-icon-wrapper">
                                                <span>Requested</span>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="action-warning">
                                                <div class="warning-icon-wrapper">
                                                    <img src="~/images/exclamation-mark.png" class="warning-icon" />
                                                </div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        if (checkRequest != null)
                                        {
                                            <div class="warning-icon-wrapper">
                                                <span>Requested</span>
                                            </div>
                                        }
                                    }
                            </div>


                        </td>
                    </tr>
                }
            </tbody>
        </table> 
</div>
<br />


<!--Request-->

<div class="ingredient-list-wrapper closeIngredientList">
    <img src="~/images/no.png" class="exitIngredientList"/>
    
    <h1 class="ingredient-list-header">List</h1>
   
    <div class="ingredient-list-th">
        <div class="th-delete"style="color: transparent">s</div>
        <div class="th-name">Name</div>
        <div class="th-quantity">Qty</div>       
    </div>
    <div class="ingredient-list-table-wrapper">
       
        <table class="ingredient-list-table">
            <tbody>

            </tbody>
        </table>
    </div>
   
    <div class="ingredient-list-footer">
        <form asp-action="AddProcess" method="post" id="formProcess">
            <div class="select-process-wrapper">
                <div class="form-group">
                    <label class="control-label">Process Type</label>
                    <select name="selectProcess" class="form-control selectProcess">
                        <option value="Request" selected>Request</option>
                        <option value="Stock In">Stock In</option>
                        <option value="Stock Out">Stock Out</option>
                    </select>                 
                </div>
            </div>
            <div class="select-remarks-wrapper">
                <div class="form-group">
                    <label class="control-label">Remarks</label>
                    <select name="stockOutRemarks" class="form-control stockOutRemarks">
                        <option value="Damaged">Damaged</option>
                        <option value="Disposed">Disposed</option>
                    </select>
                </div>
            </div>
               
              
           
           
            <input name="listData" class="listData" hidden />
        </form>
     
        <button class="d-block mx-auto processIngredientListBtn">Process</button>
    </div>
</div>


<!--Process Modal-->

<div class="modal fade" id="processDetailsModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @{
                        var dateNow = DateTime.Now.Date.ToString("yyyy-MM-dd");

                        var userId = HttpContextAccessor.HttpContext.Session.GetInt32("UserID");
                        var user = data.UserDetail.Where(s => s.UserId == userId).FirstOrDefault();
                        var fullName = user.Firstname + " " + user.Lastname;
                    }
                    <div class="form-group">
                        <label class="control-label">Date</label>
                        <input class="form-control inputReadOnlyDate" value="@dateNow" type="text" readonly />
                    </div>
                    <div class="form-group">
                        <label class="control-label">Name</label>
                        <input class="form-control inputReadOnlyUser" value="@fullName" type="text" readonly />
                    </div>
                    <div class="process-detail-header">
                        <div class="process-detail-name">
                            Name
                        </div>
                        <div class="process-detail-quantity">
                            Quantity
                        </div>
                    </div>
                    <div class="process-detail-table-wrapper">
                        <table class="process-detail-table">
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" class="d-block mx-auto processSubmit">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!--Add New Ingredient Modal-->

<div class="modal fade" id="addIngredientModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ADD INGREDIENT</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form asp-action="AddIngredient" id="addIngredientForm" method="post">

                    <div class="form-group">
                        <label asp-for="Name" class="control-label">Ingredient Name</label>
                        <input asp-for="Name" class="form-control inputIngredientName" type="text" placeholder="Enter Ingredient Name" required />                        
                    </div>
                    <div class="form-group">
                        <label asp-for="UnitOfMeasurement" class="control-label">Unit of Measurement</label>
                        <input asp-for="UnitOfMeasurement" class="form-control inputMeasurement" placeholder="Enter Unit of Measurement" required />
                    </div>
                   
                    <div class="form-group">
                        <label asp-for="LowStockThreshold" class="control-label">Stock Threshold</label>
                        <input asp-for="LowStockThreshold" step="1" class="form-control inputThreshold" placeholder="Enter Low Stock Threshold" required />
                    </div>

                    <br />
                    <div class="form-group">
                        <button type="button" class="d-block mx-auto addIngredientSubmit">ADD</button>
                    </div>            
                </form>
            </div>
        </div>
    </div>
</div>


<!--Update Ingredient Modal-->

<div class="modal fade" id="updateIngredientModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">UPDATE INGREDIENT</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form asp-action="UpdateIngredient" id="updateIngredientForm" method="post">

                    <input asp-for="IngredientId" class="inputIngredientId" hidden />

                    <div class="form-group">
                        <label asp-for="Name" class="control-label">Category Name</label>
                        <input asp-for="Name" class="form-control inputIngredientName" type="text" placeholder="Enter Ingredient Name" required />
                    </div>
                    <div class="form-group">
                        <label asp-for="UnitOfMeasurement" class="control-label">Unit of Measurement</label>
                        <input asp-for="UnitOfMeasurement" class="form-control inputMeasurement" placeholder="Enter Unit of Measurement" required />
                    </div>
                   
                    <div class="form-group">
                        <label asp-for="LowStockThreshold" class="control-label">Stock Threshold</label>
                        <input asp-for="LowStockThreshold" class="form-control inputThreshold" placeholder="Enter Low Stock Threshold" required />
                    </div>

                    <br />
                    <div class="form-group">
                        <button type="button" class="d-block mx-auto updateIngredientSubmit">UPDATE</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



@if (TempData["AddIngredient"] != null)
{
    <script>
        Swal.fire({
            text: "Ingredient Added",
            icon: "success",
            showConfirmButton: false,
            timer: 2000
        });


    </script>

}

@if (TempData["Exist"] != null)
{
    <script>
        Swal.fire({
            text: "Ingredient already exist",
            icon: "error",
            showConfirmButton: false,
            timer: 2000
        });
    </script>
}
@if (TempData["StockIn"] != null)
{
    <script>
        Swal.fire({
            text: "Stock In Complete",
            icon: "success",
            showConfirmButton: false,
            timer: 2000
        });
    </script>
}
@if (TempData["Insufficient"] != null)
{
    <script>
        Swal.fire({
            text: "Insufficient Quantity",
            icon: "error",
            showConfirmButton: false,
            timer: 2000
        });
    </script>
}


@if (TempData["StockOut"] != null)
{
    <script>
        Swal.fire({
            text: "Stock Out Complete",
            icon: "success",
            showConfirmButton: false,
            timer: 2000
        });
    </script>
}
@if (TempData["UpdateIngredient"] != null)
{
    <script>
        Swal.fire({
            text: "Ingredient Updated",
            icon: "success",
            showConfirmButton: false,
            timer: 2000
        });
    </script>
}
@if (TempData["AddRequest"] != null)
{
    <script>
        Swal.fire({
            text: "Request Complete",
            icon: "success",
            showConfirmButton: false,
            timer: 2000
        });
    </script>
}